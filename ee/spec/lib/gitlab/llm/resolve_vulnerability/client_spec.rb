# frozen_string_literal: true

require 'spec_helper'

RSpec.describe Gitlab::Llm::ResolveVulnerability::Client, feature_category: :ai_abstraction_layer do
  let_it_be(:user) { create(:user) }
  let_it_be(:api_key) { 'api-key' }
  let_it_be(:unit_primitive) { 'resolve_vulnerability' }
  let_it_be(:tracking_context) { { request_id: 'uuid', action: 'chat' } }

  before do
    available_service_data = instance_double(CloudConnector::BaseAvailableServiceData, access_token: api_key)
    allow(::CloudConnector::AvailableServices).to receive(:find_by_name).and_return(available_service_data)
  end

  describe '#api_key' do
    it 'returns the api key' do
      client = described_class.new(user, unit_primitive: unit_primitive, tracking_context: tracking_context)
      expect(client.api_key).to eq(api_key)
    end
  end
end
