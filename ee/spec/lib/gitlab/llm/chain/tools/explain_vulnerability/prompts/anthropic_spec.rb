# frozen_string_literal: true

require 'spec_helper'

RSpec.describe Gitlab::Llm::Chain::Tools::ExplainVulnerability::Prompts::Anthropic, feature_category: :duo_chat do
  describe '.prompt' do
    it 'returns prompt', :aggregate_failures do
      result = described_class.prompt(
        language_info: 'language info',
        title: 'title',
        identifiers: 'vulnerabilities'
      )
      prompt = result[:prompt]

      expected_system_prompt = <<~PROMPT.chomp
        You are a software vulnerability developer.
        You can explain vulnerabilities in code.
        language info
      PROMPT

      expected_user_prompt = <<~PROMPT
        Explain the vulnerability "title - (vulnerabilities)".
        Provide a code example with syntax highlighting on how an attacker can take advantage of the vulnerability.
        Provide a code example with syntax highlighting on how to fix it.
        Provide the response in markdown format with headers.
      PROMPT

      expected_prompt = [
        {
          role: :system, content: expected_system_prompt
        },
        {
          role: :user, content: expected_user_prompt
        }
      ]
      expect(prompt).to eq(expected_prompt)
    end
  end
end
