# frozen_string_literal: true

module Gitlab
  module Llm
    module Templates
      module Vulnerabilities
        # We use this exception class for errors where we want
        # the exception message to appear verbatim in the
        # errors property of the response.
        PromptError = Class.new(StandardError)

        class ResolveVulnerability < VulnerabilityTemplate
          def to_prompt
            raise PromptError, "Unable to generate prompt for Vulnerability" unless eligible_code?

            prompt
          end

          private

          def prompt
            <<~PROMPT
            The file "#{filename}" has this vulnerable code:

            ```
            #{vulnerable_code}
            ```

            It has the security vulnerability "#{title} - (#{identifiers})". Write code that fixes the vulnerability.
            PROMPT
          end
        end
      end
    end
  end
end
