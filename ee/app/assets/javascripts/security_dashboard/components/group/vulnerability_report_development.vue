<script>
import countsQuery from 'ee/security_dashboard/graphql/queries/vulnerability_severities_count.query.graphql';
import createFlash from '~/flash';
import { s__ } from '~/locale';
import VulnerabilityCounts from '../shared/vulnerability_counts.vue';

export default {
  components: { VulnerabilityCounts },
  inject: ['groupFullPath'],
  data() {
    return {
      counts: {},
    };
  },
  apollo: {
    counts: {
      query: countsQuery,
      variables() {
        return {
          fullPath: this.groupFullPath,
          isGroup: true,
        };
      },
      update({ group }) {
        return group.vulnerabilitySeveritiesCount;
      },
      error() {
        createFlash({
          message: s__(
            'SecurityReports|Error fetching the vulnerability counts. Please check your network connection and try again.',
          ),
        });
      },
    },
  },
  computed: {
    isCountsLoading() {
      return this.$apollo.queries.counts.loading;
    },
  },
};
</script>

<template>
  <vulnerability-counts :counts="counts" :is-loading="isCountsLoading" />
</template>
