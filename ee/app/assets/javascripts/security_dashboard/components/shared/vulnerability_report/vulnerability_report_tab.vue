<script>
import { sumBy } from 'lodash';
import { GlTab, GlBadge } from '@gitlab/ui';
import VulnerabilityReport from './vulnerability_report.vue';

export default {
  components: { GlTab, GlBadge, VulnerabilityReport },
  props: {
    title: {
      type: String,
      required: true,
    },
    isActive: {
      type: Boolean,
      required: true,
    },
    type: {
      type: String,
      required: true,
    },
    query: {
      type: Object,
      required: true,
    },
    showProjectFilter: {
      type: Boolean,
      required: false,
      default: false,
    },
  },
  data() {
    return {
      counts: undefined,
    };
  },
  computed: {
    countsSum() {
      return sumBy(this.counts, (x) => x.count);
    },
  },
  methods: {
    updateCounts(counts) {
      this.counts = counts;
    },
  },
};
</script>

<template>
  <gl-tab>
    <template #title>
      <span>{{ title }}</span>
      <gl-badge size="sm" class="gl-tab-counter-badge">{{ countsSum }}</gl-badge>
    </template>

    <slot name="header"></slot>

    <vulnerability-report
      :is-active="isActive"
      :type="type"
      :query="query"
      :show-project-filter="showProjectFilter"
      @counts-changed="updateCounts"
    />
  </gl-tab>
</template>
