<script>
import VulnerabilityListGraphql from '../shared/vulnerability_report/vulnerability_list_graphql.vue';
import VulnerabilityFilters from '../shared/vulnerability_report/vulnerability_filters.vue';
import {
  FIELD_PRESETS,
  FILTER_PRESETS,
  REPORT_TAB,
  REPORT_TYPE_PRESETS,
} from '../shared/vulnerability_report/constants';
import projectVulnerabilitiesQuery from '../../graphql/queries/project_vulnerabilities.query.graphql';
import { DASHBOARD_TYPES } from '../../store/constants';

export default {
  components: {
    VulnerabilityFilters,
    VulnerabilityListGraphql,
  },
  provide() {
    return {
      dashboardType: DASHBOARD_TYPES.PROJECT,
      canAdminVulnerability: true,
      fullPath: this.projectPath,
      canViewFalsePositive: false,
      hasJiraVulnerabilitiesIntegrationEnabled: false,
    };
  },
  inject: ['projectPath'],
  data() {
    return {
      graphqlFilters: undefined,
    };
  },
  computed: {
    fieldsToShow() {
      return FIELD_PRESETS[REPORT_TAB.OPERATIONAL];
    },
    filtersToShow() {
      return FILTER_PRESETS[REPORT_TAB.OPERATIONAL];
    },
  },
  methods: {
    updateGraphqlFilters(graphqlFilters) {
      this.graphqlFilters = graphqlFilters;
      this.graphqlFilters.reportType = REPORT_TYPE_PRESETS.OPERATIONAL;
    },
  },
  REPORT_TAB,
  projectVulnerabilitiesQuery,
};
</script>

<template>
  <div>
    <vulnerability-filters
      :filters="filtersToShow"
      class="security-dashboard-filters gl-mt-7"
      @filters-changed="updateGraphqlFilters"
    />

    <vulnerability-list-graphql
      :query="$options.projectVulnerabilitiesQuery"
      :fields="fieldsToShow"
      :filters="graphqlFilters"
    />
  </div>
</template>
