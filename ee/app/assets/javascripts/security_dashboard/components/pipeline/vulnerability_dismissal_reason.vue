<script>
import { GlFormGroup, GlCollapsibleListbox } from '@gitlab/ui';
import { __, s__ } from '~/locale';
import { DISMISSAL_REASONS } from 'ee/vulnerabilities/constants';

export default {
  components: {
    GlFormGroup,
    GlCollapsibleListbox,
  },
  props: {
    value: {
      type: String,
      required: false,
      default: null,
    },
    showError: {
      type: Boolean,
      required: false,
    },
  },
  computed: {
    toggleText() {
      return this.value ? DISMISSAL_REASONS[this.value] : this.$options.i18n.selectAReason;
    },
    isInvalid() {
      return !this.value && this.showError;
    },
  },
  items: Object.entries(DISMISSAL_REASONS).map(([key, text]) => ({
    value: key,
    text,
  })),
  i18n: {
    dismissAs: s__('SecurityReports|Dismiss as'),
    selectAReason: __('Select a reason'),
    fieldRequired: __('This field is required.'),
  },
};
</script>

<template>
  <gl-form-group
    label-for="dismissal-reason"
    :label="$options.i18n.dismissAs"
    :invalid-feedback="$options.i18n.fieldRequired"
    :state="!isInvalid"
  >
    <gl-collapsible-listbox
      id="dismissal-reason"
      :items="$options.items"
      :selected="value"
      :toggle-text="toggleText"
      :variant="isInvalid ? 'danger' : 'default'"
      category="secondary"
      @select="$emit('input', $event)"
    />
  </gl-form-group>
</template>
