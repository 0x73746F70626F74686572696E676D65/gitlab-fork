<script>
import { GlCard, GlButton } from '@gitlab/ui';
import { convertToGraphQLId } from '~/graphql_shared/utils';
import { TYPENAME_VULNERABILITY } from '~/graphql_shared/constants';
import chatMutation from 'ee/ai/graphql/chat.mutation.graphql';
import { helpCenterState } from '~/super_sidebar/constants';

export default {
  components: {
    GlCard,
    GlButton,
  },
  props: {
    vulnerabilityId: { type: [Number, String], required: true },
  },
  computed: {
    vulnerabilityGraphqlId() {
      return convertToGraphQLId(TYPENAME_VULNERABILITY, this.vulnerabilityId);
    },
  },
  methods: {
    triggerDuoChat() {
      helpCenterState.showTanukiBotChatDrawer = true;

      this.$apollo.mutate({
        mutation: chatMutation,
        variables: {
          question: '/explain_vulnerability',
          resourceId: this.vulnerabilityGraphqlId,
        },
      });
    },
  },
};
</script>

<template>
  <gl-card>
    <div class="gl-mb-3">
      <span class="gl-font-bold">{{
        s__('Vulnerability|Explain this vulnerability and how to mitigate it with AI')
      }}</span>
    </div>

    <gl-button icon="tanuki-ai" data-testid="try-button" @click="triggerDuoChat">
      {{ s__('Vulnerability|Explain vulnerability') }}
    </gl-button>
  </gl-card>
</template>
